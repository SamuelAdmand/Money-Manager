(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&m(s)}).observe(document,{childList:!0,subtree:!0});function d(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(o){if(o.ep)return;o.ep=!0;const n=d(o);fetch(o.href,n)}})();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>console.log("SW Registered!",e)).catch(e=>console.log("SW registration failed: ",e))});const ie="money_manager_state";let i={accounts:[],transactions:[],emis:[],theme:"dark"};function ve(){const e=localStorage.getItem(ie);if(e)try{i=JSON.parse(e),i.emis||(i.emis=[])}catch(t){console.error("Failed to parse state:",t)}else window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(i.theme="light");re()}function g(){localStorage.setItem(ie,JSON.stringify(i)),L()}const se=document.getElementById("theme-toggle"),Y=document.getElementById("export-data"),F=document.getElementById("import-data"),E=document.getElementById("spendable-balance"),Q=document.getElementById("net-worth"),X=document.getElementById("total-investments"),Z=document.getElementById("total-debt"),ee=document.getElementById("total-emis"),ge=document.getElementById("transaction-list"),fe=document.getElementById("transaction-list-mobile"),x=document.getElementById("tab-expense-desktop"),M=document.getElementById("tab-income-desktop"),be=document.getElementById("transaction-form-desktop"),q=document.getElementById("tx-type-desktop"),Ee=document.getElementById("tx-amount-desktop"),ae=document.getElementById("tx-desc-desktop"),w=document.getElementById("tx-account-desktop"),Ie=document.getElementById("account-list-desktop"),he=document.getElementById("investment-list-desktop"),Be=document.getElementById("add-account-btn-desktop"),ke=document.getElementById("add-account-form-desktop"),Le=document.getElementById("cancel-account-btn-desktop"),De=document.getElementById("acct-name-desktop"),xe=document.getElementById("acct-type-desktop"),Me=document.getElementById("acct-balance-desktop"),we=document.getElementById("acct-balance-group-desktop"),Se=document.getElementById("acct-limit-group-desktop"),Ae=document.getElementById("acct-limit-desktop"),Te=document.getElementById("acct-outstanding-group-desktop"),$e=document.getElementById("acct-outstanding-desktop"),Ne=document.getElementById("emi-list-desktop"),Oe=document.getElementById("add-emi-btn-desktop"),Ce=document.getElementById("add-emi-form-desktop"),Fe=document.getElementById("cancel-emi-btn-desktop"),He=document.getElementById("emi-desc-desktop"),Ue=document.getElementById("emi-amount-desktop"),H=document.getElementById("emi-account-desktop"),$=document.getElementById("global-overlay"),le=document.getElementById("tx-bottom-sheet"),J=document.getElementById("account-bottom-sheet"),K=document.getElementById("emi-bottom-sheet"),te=document.getElementById("close-tx-sheet"),ne=document.getElementById("close-account-sheet"),oe=document.getElementById("close-emi-sheet"),ce=document.getElementById("mobile-add-btn"),S=document.getElementById("tab-expense-mobile"),A=document.getElementById("tab-income-mobile"),Re=document.getElementById("transaction-form-mobile"),z=document.getElementById("tx-type-mobile"),Pe=document.getElementById("tx-amount-mobile"),de=document.getElementById("tx-desc-mobile"),T=document.getElementById("tx-account-mobile"),Ge=document.getElementById("tx-presets-desktop"),Ve=document.getElementById("tx-presets-mobile"),We=document.getElementById("account-list-mobile"),_e=document.getElementById("investment-list-mobile"),U=document.getElementById("add-account-btn-mobile"),je=document.getElementById("add-account-form-mobile"),qe=document.getElementById("acct-name-mobile"),Je=document.getElementById("acct-type-mobile"),Ke=document.getElementById("acct-balance-mobile"),ze=document.getElementById("acct-balance-group-mobile"),Ye=document.getElementById("acct-limit-group-mobile"),Qe=document.getElementById("acct-limit-mobile"),Xe=document.getElementById("acct-outstanding-group-mobile"),Ze=document.getElementById("acct-outstanding-mobile"),et=document.getElementById("emi-list-mobile"),R=document.getElementById("add-emi-btn-mobile"),tt=document.getElementById("add-emi-form-mobile"),nt=document.getElementById("emi-desc-mobile"),ot=document.getElementById("emi-amount-mobile"),P=document.getElementById("emi-account-mobile"),I=document.getElementById("nav-home"),h=document.getElementById("nav-accounts"),B=document.getElementById("nav-transactions"),k=document.getElementById("nav-emis"),G=document.getElementById("home-view"),V=document.getElementById("transactions-container"),W=document.getElementById("accounts-mobile-view"),_=document.getElementById("transactions-mobile-view"),j=document.getElementById("emis-mobile-view");function re(){document.documentElement.setAttribute("data-theme",i.theme);const e=se.querySelector("ion-icon");e&&e.setAttribute("name",i.theme==="dark"?"sunny":"moon")}se.addEventListener("click",()=>{i.theme=i.theme==="dark"?"light":"dark",re(),g()});function N(e){const t=i.accounts.find(n=>n.id===e);if(!t)return 0;const d=i.transactions.filter(n=>n.accountId===e),m=d.filter(n=>n.type==="income").reduce((n,s)=>n+s.amount,0),o=d.filter(n=>n.type==="expense").reduce((n,s)=>n+s.amount,0);return t.balance+m-o}function ct(){let e=0,t=0,d=0,m=0;i.accounts.forEach(s=>{const c=N(s.id);c>0?(e+=c,s.type==="investment"&&(d+=c)):c<0&&(t+=Math.abs(c),s.type==="investment"&&(d+=c))}),i.emis.forEach(s=>{m+=s.amount});const o=e-t;return{spendable:o-d-m,netWorth:o,investments:d,debt:t,emis:m}}function v(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(e)}function L(){const e=ct();E&&(E.textContent=v(e.spendable)),Q&&(Q.textContent=v(e.netWorth)),X&&(X.textContent=v(e.investments)),Z&&(Z.textContent=v(e.debt)),ee&&(ee.textContent=v(e.emis)),E&&(e.spendable<0?E.style.color="var(--danger-color)":E.style.color="var(--primary-color)");const t=()=>{const c=i.accounts.filter(l=>l.type!=="investment");return c.length===0?'<option value="" disabled selected>No source accounts found</option>':c.map(l=>`<option value="${l.id}">${l.name} (${l.type})</option>`).join("")};w&&(w.innerHTML=t()),T&&(T.innerHTML=t()),H&&(H.innerHTML=t()),P&&(P.innerHTML=t());const d=(c,l)=>{if(!c)return;c.innerHTML="";const u=i.accounts.filter(a=>l==="investment"?a.type==="investment":a.type!=="investment");u.length===0?c.innerHTML=`<div class="empty-state"><ion-icon name="${l==="investment"?"bar-chart-outline":"wallet-outline"}"></ion-icon><p>No ${l}s yet.</p></div>`:u.forEach(a=>{const r=N(a.id),p=document.createElement("div"),y=a.type==="credit";p.className=y?"account-item credit-card-ui":"account-item";let b=v(Math.abs(r)),C=r<0?"(Owed)":"";if(y){const ye=a.limit||0;p.innerHTML=`
                    <div class="card-header">
                        <div class="account-info">
                            <h5>${a.name}</h5>
                            <p>${a.type.toUpperCase()}</p>
                        </div>
                    </div>
                    <div class="card-chip"></div>
                    <div class="card-body">
                        <div class="outstanding-amount">${b}</div>
                        <div class="outstanding-label">CURRENT OUTSTANDING</div>
                    </div>
                    <div class="card-footer">
                        <div class="card-limit">
                            LIMIT: ${v(ye)}
                        </div>
                    </div>
                `}else p.innerHTML=`
                    <div class="account-info">
                        <h5>${a.name}</h5>
                        <p>${a.type.charAt(0).toUpperCase()+a.type.slice(1)}</p>
                    </div>
                    <div class="account-balance" style="color: ${r<0?"var(--danger-color)":"inherit"}">${b} ${C}</div>
                `;c.appendChild(p)})};d(Ie,"standard"),d(he,"investment"),d(We,"standard"),d(_e,"investment");const m=[{name:"Grocery",icon:"cart-outline"},{name:"Health",icon:"heart-outline"},{name:"Dining",icon:"restaurant-outline"},{name:"Travel",icon:"airplane-outline"},{name:"Repay",icon:"arrow-undo-outline"},{name:"Salary",icon:"cash-outline"}],o=(c,l,u)=>{c&&(c.innerHTML="",m.forEach(a=>{const r=document.createElement("button");r.type="button",r.className="preset-chip",r.innerHTML=`<ion-icon name="${a.icon}"></ion-icon> ${a.name}`,r.addEventListener("click",()=>{if(a.name==="Repay"){const p=i.accounts.find(y=>y.id===u.value);if(p&&p.type==="credit"){window.repayDebt(p.id);return}else{alert("Please select a Credit Card account first to use the Repay shortcut.");return}}l.value=a.name}),c.appendChild(r)}))};o(Ge,ae,w),o(Ve,de,T);const n=c=>{c&&(c.innerHTML="",i.emis.length===0?c.innerHTML='<div class="empty-state"><ion-icon name="calendar-outline"></ion-icon><p>No active EMIs.</p></div>':i.emis.forEach(l=>{var a;const u=document.createElement("div");u.className="account-item",u.innerHTML=`
          <div class="account-info">
            <h5>${l.description}</h5>
            <p>Deducts from: ${((a=i.accounts.find(r=>r.id===l.accountId))==null?void 0:a.name)||"Unknown"}</p>
          </div>
          <div style="display: flex; align-items: center; gap: 1rem;">
             <div class="account-balance tx-expense">${v(l.amount)} /mo</div>
             <button class="btn-icon delete-emi-btn" data-id="${l.id}" style="width: 2rem; height: 2rem; border-color: transparent; box-shadow: none;">
               <ion-icon name="close-circle-outline" style="color: var(--danger-color); font-size: 1.5rem;"></ion-icon>
             </button>
          </div>
        `,c.appendChild(u)}),c.querySelectorAll(".delete-emi-btn").forEach(l=>{l.addEventListener("click",u=>{const a=u.currentTarget.dataset.id;a&&(i.emis=i.emis.filter(r=>r.id!==a),g())})}))};n(Ne),n(et);const s=c=>{c&&(c.innerHTML="",i.transactions.length===0?c.innerHTML='<div class="empty-state"><ion-icon name="receipt-outline"></ion-icon><p>No recent transactions.</p></div>':([...i.transactions].reverse().forEach(l=>{const u=i.accounts.find(y=>y.id===l.accountId),a=document.createElement("div");a.className="transaction-item tx-"+l.type;const r=l.type==="income"?"arrow-down":"arrow-up",p=l.type==="income"?"+":"-";a.innerHTML=`
          <div class="transaction-info">
            <div class="transaction-icon">
              <ion-icon name="${r}"></ion-icon>
            </div>
            <div class="transaction-details">
              <h4>${l.description}</h4>
              <p>${u?u.name:"Unknown Account"} â€¢ ${new Date(l.date).toLocaleDateString()}</p>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="transaction-amount">${p}${v(l.amount)}</div>
            <div class="transaction-actions">
              <button class="btn-icon delete-tx-btn" data-id="${l.id}" style="width: 2rem; height: 2rem;">
                <ion-icon name="trash-outline" style="color: var(--danger-color);"></ion-icon>
              </button>
            </div>
          </div>
        `,c.appendChild(a)}),c.querySelectorAll(".delete-tx-btn").forEach(l=>{l.addEventListener("click",u=>{const a=u.currentTarget.dataset.id;a&&(i.transactions=i.transactions.filter(r=>r.id!==a),g())})})))};s(ge),s(fe)}function me(e,t,d,m,o,n){e&&e.addEventListener("submit",s=>{if(s.preventDefault(),i.accounts.length===0){alert("Please create an account first.");return}const c={id:crypto.randomUUID(),type:t.value,amount:parseFloat(d.value),description:m.value.trim(),accountId:o.value,date:new Date().toISOString()};i.transactions.push(c),g(),d.value="",m.value="",n&&n()})}me(be,q,Ee,ae,w);me(Re,z,Pe,de,T,()=>{f()});function ue(e,t,d,m,o,n,s,c,l,u,a){if(!e||!t)return;const r=()=>{const p=o.value==="credit";s.style.display=p?"none":"block",c.style.display=p?"block":"none",u.style.display=p?"block":"none";const y=s.querySelector("label");y&&(y.textContent=o.value==="investment"?"Initial Value":"Initial Balance")};e.addEventListener("click",()=>{t.id.includes("mobile")?D(J):t.style.display="block",r()}),o.addEventListener("change",r),d&&d.addEventListener("click",()=>{t.style.display="none",t.reset()}),t.addEventListener("submit",p=>{p.preventDefault();const y=o.value,b=y==="credit",C={id:crypto.randomUUID(),name:m.value.trim(),type:y,balance:b?-(parseFloat(a.value)||0):parseFloat(n.value)||0,limit:b?parseFloat(l.value)||0:void 0};i.accounts.push(C),g(),t.reset(),t.id.includes("mobile")?f():t.style.display="none",L()})}ue(Be,ke,Le,De,xe,Me,we,Se,Ae,Te,$e);ue(U,je,null,qe,Je,Ke,ze,Ye,Qe,Xe,Ze);function pe(e,t,d,m,o,n){!e||!t||(e.addEventListener("click",()=>{t.id.includes("mobile")?D(K):t.style.display="block"}),d&&d.addEventListener("click",()=>{t.style.display="none",t.reset()}),t.addEventListener("submit",s=>{if(s.preventDefault(),i.accounts.length===0){alert("Please create an account first to link to an EMI.");return}const c={id:crypto.randomUUID(),description:m.value.trim(),amount:parseFloat(o.value),accountId:n.value};i.emis.push(c),g(),t.reset(),t.id.includes("mobile")?f():t.style.display="none",L()}))}pe(Oe,Ce,Fe,He,Ue,H);pe(R,tt,null,nt,ot,P);x&&x.addEventListener("click",()=>{x.classList.add("active"),M.classList.remove("active"),q.value="expense"});M&&M.addEventListener("click",()=>{M.classList.add("active"),x.classList.remove("active"),q.value="income"});S&&S.addEventListener("click",()=>{S.classList.add("active"),A.classList.remove("active"),z.value="expense"});A&&A.addEventListener("click",()=>{A.classList.add("active"),S.classList.remove("active"),z.value="income"});const D=e=>{$.classList.add("open"),e.classList.add("open")},f=()=>{$.classList.remove("open"),le.classList.remove("open"),J.classList.remove("open"),K.classList.remove("open")};ce&&ce.addEventListener("click",()=>{D(le)});te&&te.addEventListener("click",f);ne&&ne.addEventListener("click",f);oe&&oe.addEventListener("click",f);$&&$.addEventListener("click",f);U&&U.addEventListener("click",()=>{D(J)});R&&R.addEventListener("click",()=>{D(K)});const O=()=>{G&&(G.style.display="none"),V&&(V.style.display="none"),W&&(W.style.display="none"),_&&(_.style.display="none"),j&&(j.style.display="none"),I&&I.classList.remove("active"),h&&h.classList.remove("active"),B&&B.classList.remove("active"),k&&k.classList.remove("active")};I&&I.addEventListener("click",e=>{e.preventDefault(),O(),I.classList.add("active"),G.style.display="grid",V.style.display="block"});h&&h.addEventListener("click",e=>{e.preventDefault(),O(),h.classList.add("active"),W.style.display="block"});B&&B.addEventListener("click",e=>{e.preventDefault(),O(),B.classList.add("active"),_.style.display="block"});k&&k.addEventListener("click",e=>{e.preventDefault(),O(),k.classList.add("active"),j.style.display="block"});Y&&Y.addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",`money_manager_backup_${new Date().toISOString().split("T")[0]}.json`),t.click()});F&&F.addEventListener("change",e=>{var m;const t=(m=e.target.files)==null?void 0:m[0];if(!t)return;const d=new FileReader;d.onload=o=>{var n;try{const s=JSON.parse((n=o.target)==null?void 0:n.result);s&&Array.isArray(s.accounts)&&Array.isArray(s.transactions)?(i={...i,accounts:s.accounts,transactions:s.transactions,emis:Array.isArray(s.emis)?s.emis:[]},g(),alert("Data imported successfully!")):alert("Invalid backup file format.")}catch(s){console.error(s),alert("Error parsing backup file.")}F.value=""},d.readAsText(t)});ve();L();window.repayDebt=e=>{const t=i.accounts.find(r=>r.id===e);if(!t)return;const d=Math.abs(N(e));if(d<=0){alert("No outstanding balance to repay!");return}const m=prompt(`Repay Credit Card Debt

Current Outstanding: ${v(d)}

Enter amount to repay:`,d.toString());if(!m)return;const o=parseFloat(m);if(isNaN(o)||o<=0){alert("Invalid amount");return}const n=i.accounts.filter(r=>r.type!=="credit"&&r.type!=="investment");if(n.length===0){alert("No source account available to pay from!");return}let s=n.map((r,p)=>`${p+1}. ${r.name} (${v(N(r.id))})`).join(`
`);const c=prompt(`Select source account:

${s}`,"1");if(!c)return;const l=parseInt(c)-1,u=n[l];if(!u){alert("Invalid selection");return}const a=`Repayment for ${t.name}`;i.transactions.push({id:crypto.randomUUID(),amount:o,description:a,type:"expense",accountId:u.id,date:new Date().toISOString()}),i.transactions.push({id:crypto.randomUUID(),amount:o,description:a,type:"income",accountId:t.id,date:new Date().toISOString()}),g(),alert("Repayment successful!"),L()};
